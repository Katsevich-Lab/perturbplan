<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute post-hoc power analysis for individual perturbation-gene pairs — compute_power_posthoc • perturbplan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute post-hoc power analysis for individual perturbation-gene pairs — compute_power_posthoc"><meta name="description" content="This function performs post-hoc power analysis using detailed experimental information.
Unlike compute_power_plan, this function accepts specific cell count
assignments per gRNA (via cells_per_grna) and calculates power for individual
perturbation-gene pairs. Also, we don't allow specifying multiple experimental designs.
This is useful for analyzing completed experiments or evaluating
specific experimental designs with known cell distributions, providing individual power
estimates for each perturbation-gene pair as well as expected total discoveries."><meta property="og:description" content="This function performs post-hoc power analysis using detailed experimental information.
Unlike compute_power_plan, this function accepts specific cell count
assignments per gRNA (via cells_per_grna) and calculates power for individual
perturbation-gene pairs. Also, we don't allow specifying multiple experimental designs.
This is useful for analyzing completed experiments or evaluating
specific experimental designs with known cell distributions, providing individual power
estimates for each perturbation-gene pair as well as expected total discoveries."><meta property="og:image" content="https://katsevich-lab.github.io/perturbplan/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">perturbplan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/preprocess-reference.html">Prepare Data For Web App</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://katsevich-lab-perturbplan.share.connect.posit.cloud/"><span class="fa fa-external-link-alt"></span> Web App</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Katsevich-Lab/perturbplan" aria-label="GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute post-hoc power analysis for individual perturbation-gene pairs</h1>

      <div class="d-none name"><code>compute_power_posthoc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs post-hoc power analysis using detailed experimental information.
Unlike <code><a href="compute_power_plan.html">compute_power_plan</a></code>, this function accepts specific cell count
assignments per gRNA (via <code>cells_per_grna</code>) and calculates power for individual
perturbation-gene pairs. Also, we don't allow specifying multiple experimental designs.
This is useful for analyzing completed experiments or evaluating
specific experimental designs with known cell distributions, providing individual power
estimates for each perturbation-gene pair as well as expected total discoveries.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compute_power_posthoc</span><span class="op">(</span></span>
<span>  <span class="va">discovery_pairs</span>,</span>
<span>  <span class="va">cells_per_grna</span>,</span>
<span>  <span class="va">baseline_expression_stats</span>,</span>
<span>  <span class="va">control_group</span>,</span>
<span>  <span class="va">fold_change_mean</span>,</span>
<span>  <span class="va">fold_change_sd</span>,</span>
<span>  num_total_cells <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_nonzero_trt_thresh <span class="op">=</span> <span class="fl">7L</span>,</span>
<span>  n_nonzero_cntrl_thresh <span class="op">=</span> <span class="fl">7L</span>,</span>
<span>  side <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  multiple_testing_method <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  multiple_testing_alpha <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-discovery-pairs">discovery_pairs<a class="anchor" aria-label="anchor" href="#arg-discovery-pairs"></a></dt>
<dd><p>A data frame specifying which element-gene pairs to consider, with columns <code>grna_target</code> and <code>response_id</code></p></dd>


<dt id="arg-cells-per-grna">cells_per_grna<a class="anchor" aria-label="anchor" href="#arg-cells-per-grna"></a></dt>
<dd><p>A data frame specifying how many cells contain each gRNA, with columns <code>grna_id</code>, <code>grna_target</code>, and <code>num_cells</code></p></dd>


<dt id="arg-baseline-expression-stats">baseline_expression_stats<a class="anchor" aria-label="anchor" href="#arg-baseline-expression-stats"></a></dt>
<dd><p>A data frame specifying the baseline expression statistics for each gene, with columns <code>response_id</code>, <code>expression_mean</code>, and <code>expression_size</code></p></dd>


<dt id="arg-control-group">control_group<a class="anchor" aria-label="anchor" href="#arg-control-group"></a></dt>
<dd><p>A character string specifying the control group, either "complement" or "nt_cells"</p></dd>


<dt id="arg-fold-change-mean">fold_change_mean<a class="anchor" aria-label="anchor" href="#arg-fold-change-mean"></a></dt>
<dd><p>A numeric value to use for mean effect size for all element-gene pairs</p></dd>


<dt id="arg-fold-change-sd">fold_change_sd<a class="anchor" aria-label="anchor" href="#arg-fold-change-sd"></a></dt>
<dd><p>A numeric value to use for standard deviation of effect size for all element-gene pairs</p></dd>


<dt id="arg-num-total-cells">num_total_cells<a class="anchor" aria-label="anchor" href="#arg-num-total-cells"></a></dt>
<dd><p>(Required only if control_group == "complement") A positive integer specifying the total number of cells in the experiment</p></dd>


<dt id="arg-cutoff">cutoff<a class="anchor" aria-label="anchor" href="#arg-cutoff"></a></dt>
<dd><p>(Optional) A numeric value between 0 and 1 to use as the p-value cutoff</p></dd>


<dt id="arg-n-nonzero-trt-thresh">n_nonzero_trt_thresh<a class="anchor" aria-label="anchor" href="#arg-n-nonzero-trt-thresh"></a></dt>
<dd><p>(Optional) An integer specifying the sceptre QC parameter of the same name; defaults to 7</p></dd>


<dt id="arg-n-nonzero-cntrl-thresh">n_nonzero_cntrl_thresh<a class="anchor" aria-label="anchor" href="#arg-n-nonzero-cntrl-thresh"></a></dt>
<dd><p>(Optional) An integer specifying the sceptre QC parameter of the same name; defaults to 7</p></dd>


<dt id="arg-side">side<a class="anchor" aria-label="anchor" href="#arg-side"></a></dt>
<dd><p>(Optional) A character string specifying the side of the test, either "left", "right", or "both"; defaults to "both"</p></dd>


<dt id="arg-multiple-testing-method">multiple_testing_method<a class="anchor" aria-label="anchor" href="#arg-multiple-testing-method"></a></dt>
<dd><p>(Optional) A character string specifying the multiple testing correction method to use, either "BH" or "bonferroni"; defaults to "BH"</p></dd>


<dt id="arg-multiple-testing-alpha">multiple_testing_alpha<a class="anchor" aria-label="anchor" href="#arg-multiple-testing-alpha"></a></dt>
<dd><p>(Optional) A numeric value between 0 and 1 specifying the alpha level for multiple testing correction; defaults to 0.1</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with two elements: <code>individual_power</code> (a data frame with columns <code>grna_target</code>, <code>response_id</code>, and <code>power</code>) and <code>expected_num_discoveries</code> (a numeric value)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## --- Toy perturb-seq dataset setup ---</span></span></span>
<span class="r-in"><span><span class="co"># Total number of cells in the experiment</span></span></span>
<span class="r-in"><span><span class="va">num_total_cells</span> <span class="op">&lt;-</span> <span class="fl">1000L</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Number of cells receiving each gRNA</span></span></span>
<span class="r-in"><span><span class="co"># (3 enhancers × 2 gRNAs each + 2 non-targeting gRNAs)</span></span></span>
<span class="r-in"><span><span class="va">cells_per_grna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  grna_id      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"enh1_grna1"</span>,<span class="st">"enh2_grna1"</span>,<span class="st">"enh3_grna1"</span>,<span class="st">"nt_grna1"</span>,</span></span>
<span class="r-in"><span>                   <span class="st">"enh1_grna2"</span>,<span class="st">"enh2_grna2"</span>,<span class="st">"enh3_grna2"</span>,<span class="st">"nt_grna2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  grna_target  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"enh1"</span>,<span class="st">"enh2"</span>,<span class="st">"enh3"</span>,<span class="st">"non-targeting"</span>,</span></span>
<span class="r-in"><span>                   <span class="st">"enh1"</span>,<span class="st">"enh2"</span>,<span class="st">"enh3"</span>,<span class="st">"non-targeting"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  num_cells    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">93L</span>,<span class="fl">113L</span>,<span class="fl">112L</span>,<span class="fl">104L</span>,<span class="fl">84L</span>,<span class="fl">104L</span>,<span class="fl">107L</span>,<span class="fl">105L</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Baseline expression statistics (negative binomial mean and size per gene)</span></span></span>
<span class="r-in"><span><span class="va">baseline_expression_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  response_id       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  expression_mean   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.002931</span>, <span class="fl">12.326867</span>, <span class="fl">4.014221</span>, <span class="fl">1.460472</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  expression_size   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2967991</span>, <span class="fl">8.3723191</span>, <span class="fl">2.5988431</span>, <span class="fl">2.6746265</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Discovery pairs: test 3 enhancers against 4 genes</span></span></span>
<span class="r-in"><span><span class="va">discovery_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  grna_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"enh1"</span>,<span class="st">"enh2"</span>,<span class="st">"enh3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  response_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  KEEP.OUT.ATTRS <span class="op">=</span> <span class="cn">FALSE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span>, <span class="op">{</span> <span class="va">grna_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">grna_target</span><span class="op">)</span>; <span class="va">response_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">response_id</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## --- Analysis choices ---</span></span></span>
<span class="r-in"><span><span class="va">control_group</span> <span class="op">&lt;-</span> <span class="st">"complement"</span>          <span class="co"># use complement control group</span></span></span>
<span class="r-in"><span><span class="va">side</span> <span class="op">&lt;-</span> <span class="st">"left"</span>                         <span class="co"># left-sided test</span></span></span>
<span class="r-in"><span><span class="va">n_nonzero_trt_thresh</span>   <span class="op">&lt;-</span> <span class="fl">7L</span>            <span class="co"># min. nonzero counts in treatment</span></span></span>
<span class="r-in"><span><span class="va">n_nonzero_cntrl_thresh</span> <span class="op">&lt;-</span> <span class="fl">7L</span>            <span class="co"># min. nonzero counts in control</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## --- Power analysis parameters ---</span></span></span>
<span class="r-in"><span><span class="va">fold_change_mean</span> <span class="op">&lt;-</span> <span class="fl">0.85</span>                <span class="co"># expected mean fold change</span></span></span>
<span class="r-in"><span><span class="va">fold_change_sd</span>   <span class="op">&lt;-</span> <span class="fl">0.13</span>                <span class="co"># expected SD of fold change</span></span></span>
<span class="r-in"><span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.005</span>                         <span class="co"># significance threshold (p-value cutoff)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## --- Run PerturbPlan posthoc power analysis ---</span></span></span>
<span class="r-in"><span><span class="va">power_results</span> <span class="op">&lt;-</span> <span class="fu">compute_power_posthoc</span><span class="op">(</span></span></span>
<span class="r-in"><span>  num_total_cells <span class="op">=</span> <span class="va">num_total_cells</span>,</span></span>
<span class="r-in"><span>  cells_per_grna <span class="op">=</span> <span class="va">cells_per_grna</span>,</span></span>
<span class="r-in"><span>  baseline_expression_stats <span class="op">=</span> <span class="va">baseline_expression_stats</span>,</span></span>
<span class="r-in"><span>  discovery_pairs <span class="op">=</span> <span class="va">discovery_pairs</span>,</span></span>
<span class="r-in"><span>  control_group <span class="op">=</span> <span class="va">control_group</span>,</span></span>
<span class="r-in"><span>  side <span class="op">=</span> <span class="va">side</span>,</span></span>
<span class="r-in"><span>  n_nonzero_trt_thresh <span class="op">=</span> <span class="va">n_nonzero_trt_thresh</span>,</span></span>
<span class="r-in"><span>  n_nonzero_cntrl_thresh <span class="op">=</span> <span class="va">n_nonzero_cntrl_thresh</span>,</span></span>
<span class="r-in"><span>  fold_change_mean <span class="op">=</span> <span class="va">fold_change_mean</span>,</span></span>
<span class="r-in"><span>  fold_change_sd <span class="op">=</span> <span class="va">fold_change_sd</span>,</span></span>
<span class="r-in"><span>  cutoff <span class="op">=</span> <span class="va">cutoff</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect outputs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">power_results</span><span class="op">)</span>                    <span class="co"># available fields</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "individual_power"         "expected_num_discoveries"</span>
<span class="r-in"><span><span class="va">power_results</span><span class="op">$</span><span class="va">expected_num_discoveries</span>  <span class="co"># expected number of discoveries</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4.8324</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">power_results</span><span class="op">$</span><span class="va">individual_power</span><span class="op">)</span>    <span class="co"># power per enhancer-gene pair</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   grna_target response_id  power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> enh1        gene1       0.066<span style="text-decoration: underline;">0</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> enh2        gene1       0.083<span style="text-decoration: underline;">1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> enh3        gene1       0.083<span style="text-decoration: underline;">9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> enh1        gene2       0.718 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> enh2        gene2       0.744 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> enh3        gene2       0.745 </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ziang Niu, Yihui He, Eugene Katsevich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

