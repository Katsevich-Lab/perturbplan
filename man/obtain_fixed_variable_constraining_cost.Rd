% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/power_plan.R
\name{obtain_fixed_variable_constraining_cost}
\alias{obtain_fixed_variable_constraining_cost}
\title{Calculate optimal experimental design parameters under cost constraints}
\usage{
obtain_fixed_variable_constraining_cost(
  cost_per_captured_cell = 0.086,
  cost_per_million_reads = 0.374,
  cost_constraint,
  MOI = 10,
  num_targets = 100,
  non_targeting_gRNAs = 10,
  gRNAs_per_target = 4,
  reads_per_cell,
  cells_per_target,
  mapping_efficiency = 0.72
)
}
\arguments{
\item{cost_per_captured_cell}{Numeric. Cost per captured cell in dollars (default: 0.086).
Used for library preparation cost calculations.}

\item{cost_per_million_reads}{Numeric. Cost per million sequencing reads in dollars
(default: 0.374). Used for sequencing cost calculations.}

\item{cost_constraint}{Numeric. Total budget constraint in dollars. Must be positive.}

\item{MOI}{Numeric. Multiplicity of infection parameter (default: 10). Used to compute
the number of captured cells from cells per target.}

\item{num_targets}{Integer. Number of target genes in the experiment (default: 100).}

\item{non_targeting_gRNAs}{Integer. Number of non-targeting gRNAs (default: 10).}

\item{gRNAs_per_target}{Integer. Number of gRNAs per target gene (default: 4).}

\item{reads_per_cell}{Numeric or NULL. If provided, this parameter is fixed and
\code{cells_per_target} will be optimized. If NULL, this parameter will be optimized.}

\item{cells_per_target}{Numeric or NULL. If provided, this parameter is fixed and
\code{reads_per_cell} will be optimized. If NULL, this parameter will be optimized.}

\item{mapping_efficiency}{Numeric. Mapping efficiency of sequencing platform
(default: 0.72). Used to convert between raw reads and mapped reads.}
}
\value{
A list containing:
\describe{
\item{cells_per_target}{Numeric. Optimized or provided cells per target value}
\item{reads_per_cell}{Numeric. Optimized or provided reads per cell value}
}
}
\description{
This function determines the optimal experimental design parameters (cells per target
and reads per cell) given a total cost constraint. It handles two optimization scenarios:

\itemize{
\item When \code{reads_per_cell} is NULL: Calculates the maximum reads per cell
achievable given a fixed \code{cells_per_target} within the cost constraint
\item When \code{cells_per_target} is NULL: Calculates the maximum cells per target
achievable given a fixed \code{reads_per_cell} within the cost constraint
}
}
\details{
The function uses a cost model where total cost = cell preparation cost + sequencing cost:
\itemize{
\item Cell preparation cost = \code{cost_per_captured_cell * num_captured_cells}
\item Sequencing cost = \code{cost_per_million_reads * total_reads / 1e6}
\item \code{num_captured_cells = ((gRNAs_per_target * num_targets + non_targeting_gRNAs) * cells_per_target / gRNAs_per_target) / MOI}
\item \code{total_reads = num_captured_cells * reads_per_cell / mapping_efficiency}
}

\strong{Optimization Logic:}

\strong{Scenario 1 (reads_per_cell = NULL):} Given fixed \code{cells_per_target}, maximizes
\code{reads_per_cell} within cost constraint by allocating remaining budget after cell
preparation costs to sequencing.

\strong{Scenario 2 (cells_per_target = NULL):} Given fixed \code{reads_per_cell}, maximizes
\code{cells_per_target} (equivalently, captured cells) within cost constraint using
the total cost per captured cell (including both preparation and sequencing costs).
}
\section{Error Handling}{

The function validates that the cost constraint is sufficient for meaningful experiments:
\itemize{
\item Ensures at least 10 reads per cell can be achieved
\item Ensures at least 10 captured cells can be achieved
\item Provides clear error messages when constraints are too tight
}
}

\examples{
\dontrun{
# Optimize reads per cell given fixed cells per target
result1 <- obtain_fixed_variable_constraining_cost(
  cost_constraint = 1000,
  cells_per_target = 100,
  reads_per_cell = NULL
)

# Optimize cells per target given fixed reads per cell  
result2 <- obtain_fixed_variable_constraining_cost(
  cost_constraint = 1000,
  cells_per_target = NULL, 
  reads_per_cell = 5000
)
}

}
\seealso{
\code{\link{cost_power_computation}} for cost-constrained power analysis that uses this function
}
