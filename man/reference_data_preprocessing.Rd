% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pilot_data_preprocessing.R
\name{reference_data_preprocessing}
\alias{reference_data_preprocessing}
\title{Pilot Dataset Preprocessing for Power Analysis}
\usage{
reference_data_preprocessing(
  response_matrix = NULL,
  read_umi_table,
  n_threads = NULL,
  downsample_ratio = 0.7,
  TPM_thres = 1,
  D2_rough = 0.3,
  h5_only = FALSE
)
}
\arguments{
\item{response_matrix}{Matrix or NULL. Gene-by-cell matrix of normalized expression
responses, typically from \code{\link{reference_data_preprocessing_10x}}. If \code{h5_only = TRUE},
this can be NULL.}

\item{read_umi_table}{Data frame. QC information from molecule_info.h5 or filtered_feature_bc_matrix.h5,
as obtained via \code{\link{obtain_qc_read_umi_table}}.}

\item{n_threads}{Integer. Number of threads used for parallel processing. Default: NULL (single-threaded).}

\item{downsample_ratio}{Numeric. Proportion of downsampling used for library size estimation. Default: 0.7.}

\item{TPM_thres}{Numeric. Threshold for filtering low-expression genes during preprocessing.}

\item{D2_rough}{Numeric. Rough prior value for library variation parameter. Default: 0.3.}

\item{h5_only}{Logical. If TRUE, skips baseline expression and dispersion estimation
steps (only processes read_umi_table). Default: FALSE.}
}
\value{
A list containing:
\describe{
\item{baseline_expression}{List with:
\itemize{
\item \code{baseline_expression}: Data frame with gene-level expression statistics.
\item \code{expression_dispersion_curve}: Function mapping expression to dispersion.
}}
\item{library_parameters}{List with:
\itemize{
\item \code{UMI_per_cell}: Estimated UMI/cell count.
\item \code{variation}: Estimated variation parameter for PCR bias.
}}
}
}
\description{
Further process sequencing data to extract gene-level expression and library
statistics required by the PerturbPlan simulation framework. Outputs are
compatible with built-in pilot examples.
}
\details{
This function executes the core steps in the pilot data setup for PerturbPlan:
\enumerate{
\item Computes gene expression means and variances from response matrix.
\item Fits a nonparametric dispersion curve.
\item Extracts library-level statistics from HDF5 molecule info.
\item Outputs a list structure matching internal pilot examples.
}
}
\seealso{
\code{\link{obtain_expression_information}},
\code{\link{obtain_expression_dispersion_curve}},
\code{\link{obtain_qc_read_umi_table}},
\code{\link{library_estimation}}
}
