% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pilot_data_help.R
\name{obtain_qc_read_umi_table}
\alias{obtain_qc_read_umi_table}
\title{Extract UMI-Level Molecule Information from Cell Ranger HDF5 Files}
\usage{
obtain_qc_read_umi_table(path_to_cellranger_output)
}
\arguments{
\item{path_to_cellranger_output}{Character. Path to Cell Ranger run folder
containing:
\itemize{
\item \code{outs/molecule_info.h5} – Raw molecule information with required datasets:
\itemize{
\item \code{count}: Number of reads per molecule
\item \code{umi}: UMI indices
\item \code{barcodes}: Cell barcodes (without GEM group suffix)
\item \code{barcode_idx}: Barcode indices (0-based)
\item \code{gem_group}: GEM group identifiers
\item \code{feature_idx}: Feature indices (0-based)
\item \code{features/id}: Gene identifiers
\item \code{features/feature_type}: Feature types (e.g., "Gene Expression")
}
\item \code{outs/filtered_feature_bc_matrix.h5} – QC-filtered cell barcodes with:
\itemize{
\item \code{matrix/barcodes}: Cell barcodes passing QC filters
}
}}
}
\value{
Data frame with UMI-level molecule information containing columns:
\describe{
\item{num_reads}{Number of reads supporting this UMI-cell combination}
\item{UMI_id}{UMI index (1-based)}
\item{cell_id}{Cell barcode with GEM group suffix (e.g., "ACGTACGT-1")}
\item{response_id}{Gene identifier (e.g., Ensembl ID)}
}
}
\description{
Extracts QC-filtered UMI-level molecule information from Cell Ranger HDF5 files.
Only molecules with \code{feature_type == "Gene Expression"} are retained; other
feature types (e.g., "Antibody Capture", "CRISPR Guide Capture") are filtered out.
This function is used internally by \code{\link{reference_data_preprocessing_10x}}.
}
\details{
The function:
\enumerate{
\item Reads raw molecule information from \code{molecule_info.h5}
\item Reads QC-filtered cell barcodes from \code{filtered_feature_bc_matrix.h5}
\item Filters molecule data to retain only QC-passed cells
\item Filters to retain only molecules with \code{feature_type == "Gene Expression"}
\item Constructs cell IDs with GEM group suffixes
\item Returns data frame with read counts per UMI per cell for Gene Expression features only
}

This data is used for fitting the library saturation (S-M) curve in
\code{\link{library_computation}}.
}
\examples{
# Extract read/UMI information from Cell Ranger output
cellranger_path <- system.file("extdata/cellranger_tiny", package = "perturbplan")
qc_table <- obtain_qc_read_umi_table(cellranger_path)

# Examine the data
head(qc_table)
dim(qc_table)
summary(qc_table$num_reads)

}
\seealso{
\code{\link{reference_data_preprocessing_10x}} for aggregating data from multiple runs.

\code{\link{library_computation}} for fitting saturation curves using this data.
}
\keyword{internal}
