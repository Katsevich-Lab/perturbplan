% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/power_plan.R
\name{find_optimal_cost_design}
\alias{find_optimal_cost_design}
\title{Find Optimal Cost-Efficient Experimental Designs}
\usage{
find_optimal_cost_design(
  cost_power_df,
  minimizing_variable,
  power_target,
  power_precision,
  MOI = 10,
  num_targets = 100,
  non_targeting_gRNAs = 10,
  gRNAs_per_target = 4,
  cost_per_captured_cell = 0.086,
  cost_per_million_reads = 0.374,
  cost_grid_size = 200
)
}
\arguments{
\item{cost_power_df}{Data frame. Output from \code{\link{cost_power_computation}}
containing power analysis results with cost calculations. Must include columns:
\code{overall_power}, \code{total_cost}, \code{cells_per_target},
\code{raw_reads_per_cell}, plus the specified minimizing variable (except for cost optimization).}

\item{minimizing_variable}{Character. The parameter being optimized. Must be one of:
\itemize{
\item "TPM_threshold": TPM expression threshold optimization
\item "minimum_fold_change": Minimum fold change threshold optimization
\item "cost": Total cost optimization across all experimental designs
}}

\item{power_target}{Numeric. Target statistical power level (typically 0.8 for 80\% power).
Must be between 0 and 1.}

\item{power_precision}{Numeric. Acceptable precision around power target. Designs with
power within \code{power_target ± power_precision} are considered acceptable.
Must be between 0 and 1.}

\item{MOI}{Numeric. Multiplicity of infection parameter for experimental design
calculations (default: 10). Used to compute number of captured cells.}

\item{num_targets}{Integer. Number of target genes in the experiment (default: 100).
Used for cost calculations.}

\item{non_targeting_gRNAs}{Integer. Number of non-targeting gRNAs in the experiment
(default: 10). Used to calculate total library size and captured cell requirements.}

\item{gRNAs_per_target}{Integer. Number of gRNAs per target gene (default: 4).
Used to calculate total gRNAs and experimental design parameters.}

\item{cost_per_captured_cell}{Numeric. Cost per captured cell in dollars
(default: 0.086). Used for library preparation cost calculations.}

\item{cost_per_million_reads}{Numeric. Cost per million sequencing reads in dollars
(default: 0.374). Used for sequencing cost calculations.}

\item{cost_grid_size}{Integer. Number of grid points for cost optimization grid
(default: 200). Higher values provide finer resolution but longer computation time.}
}
\value{
A list containing two elements:
\describe{
\item{optimal_cost_power_df}{Data frame with optimal power-cost combinations,
including columns from input plus minimum cost information and cost precision.}
\item{optimal_cost_grid}{Data frame with nested cost grids for each parameter level,
containing detailed design alternatives within cost precision bounds.}
}
}
\description{
Identifies cost-optimal experimental designs that achieve target statistical power
within specified precision bounds. This function processes cost-power analysis results
to find minimal-cost designs for each parameter level and generates detailed cost
grids for design optimization.
}
\details{
This function implements a three-stage cost optimization process:

\strong{Stage 1: Power Filtering}
\enumerate{
\item Filters input data to designs achieving power within target ± precision
\item Ensures only viable designs (meeting power requirements) are considered
}

\strong{Stage 2: Cost Optimization}
\enumerate{
\item Groups designs by minimizing variable (e.g., TPM_threshold levels)
\item Identifies minimum cost for each parameter level
\item Computes cost precision (1\% of minimum cost) for grid generation
\item Records parameter ranges (min/max cells and reads per cell) for each level
}

\strong{Stage 3: Design Grid Generation}
\enumerate{
\item Creates log-spaced grids within parameter ranges for each level
\item Computes detailed cost components (library + sequencing costs)
\item Filters to designs within cost precision bounds (±1\% of minimum cost)
\item Applies sampling to reduce redundant designs while preserving diversity
}

\strong{Cost Model:}
\deqn{Total Cost = Library Cost + Sequencing Cost}
\deqn{Library Cost = cost\_per\_captured\_cell \times num\_captured\_cells}
\deqn{Sequencing Cost = cost\_per\_million\_reads \times reads\_per\_cell \times num\_captured\_cells / 10^6}
\deqn{num\_captured\_cells = \frac{(gRNAs\_per\_target \times num\_targets + non\_targeting\_gRNAs) \times cells\_per\_target}{gRNAs\_per\_target \times MOI}}

The function is designed to work with output from \code{cost_power_computation()}
and provides fine-grained cost optimization for experimental design selection.
}
\examples{
# Load pilot data and perform cost-power analysis
pilot_data <- get_pilot_data_from_package("K562")
cost_results <- cost_power_computation(
  minimizing_variable = "TPM_threshold",
  fixed_variable = list(minimum_fold_change = 0.8),
  baseline_expression_stats = pilot_data$baseline_expression_stats,
  library_parameters = pilot_data$library_parameters,
  power_target = 0.8,
  cost_constraint = 15000
)

# Find optimal cost-efficient designs
optimal_designs <- find_optimal_cost_design(
  cost_power_df = cost_results,
  minimizing_variable = "TPM_threshold",
  power_target = 0.8,
  power_precision = 0.02,
  num_targets = 100,
  non_targeting_gRNAs = 10,
  gRNAs_per_target = 4,
  cost_grid_size = 100
)

# Examine optimal designs
head(optimal_designs$optimal_cost_power_df)

# Examine detailed cost grids
optimal_designs$optimal_cost_grid$cost_grid[[1]]

# Find globally optimal cost design across all parameters
cost_optimal <- find_optimal_cost_design(
  cost_power_df = cost_results,
  minimizing_variable = "cost",
  power_target = 0.8,
  power_precision = 0.02,
  cost_grid_size = 50
)

}
\seealso{
\code{\link{cost_power_computation}} for the underlying cost-power analysis
}
