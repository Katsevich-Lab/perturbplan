% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pilot_data_preprocessing.R
\name{reference_data_processing}
\alias{reference_data_processing}
\title{Pilot Dataset Preprocessing for Power Analysis}
\usage{
reference_data_processing(
  response_matrix = NULL,
  read_umi_table,
  mapping_efficiency = NULL,
  n_threads = NULL,
  TPM_thres = 0.1,
  downsample_ratio = 0.7,
  D2_rough = 0.3,
  h5_only = FALSE
)
}
\arguments{
\item{response_matrix}{Matrix or NULL. Gene-by-cell matrix of normalized expression
responses, typically from \code{\link{reference_data_preprocessing_10x}}. If \code{h5_only = TRUE},
this can be NULL.}

\item{read_umi_table}{Data frame. QC information from molecule_info.h5 or filtered_feature_bc_matrix.h5,
as obtained via \code{\link{obtain_qc_read_umi_table}}.}

\item{mapping_efficiency}{Numeric. Estimated mapping efficiency from
\code{obtain_mapping_efficiency}.}

\item{n_threads}{Integer. Number of threads used for parallel processing. Default: NULL (single-threaded).}

\item{TPM_thres}{Numeric. Threshold for filtering low-expression genes during preprocessing.}

\item{downsample_ratio}{Numeric. Proportion of downsampling used for library size estimation. Default: 0.7.}

\item{D2_rough}{Numeric. Rough prior value for library variation parameter. Default: 0.3.}

\item{h5_only}{Logical. If TRUE, skips baseline expression estimation step (only processes read_umi_table). Default: FALSE.}
}
\value{
A list containing:
\describe{
\item{baseline_expression_stats}{Data frame with gene-level expression statistics including
response_id, relative_expression, and expression_size columns.}
\item{library_parameters}{List with:
\itemize{
\item \code{UMI_per_cell}: Estimated UMI/cell count.
\item \code{variation}: Estimated variation parameter for PCR bias.
}}
\item{mapping_efficiency}{Numeric value representing mapping efficiency.}
}
}
\description{
Further process sequencing data to extract gene-level expression and library
statistics required by the PerturbPlan simulation framework. Outputs are
compatible with built-in pilot examples.
}
\details{
This function executes the core steps in the pilot data setup for PerturbPlan:
\enumerate{
\item Computes gene expression means and variances from response matrix.
\item Extracts library-level statistics from HDF5 molecule info.
\item Outputs a simplified list structure for power analysis.
}
}
\examples{
# set seed for reproducibility
set.seed(123)
# First get raw data using reference_data_preprocessing_10x
extdata_path <- system.file("extdata", package = "perturbplan")
# Get raw data from 10x output
raw_data <- reference_data_preprocessing_10x(
  path_to_top_level_output = extdata_path,
  path_to_run_level_output = "cellranger_tiny",
  h5_rough = TRUE
)
# Process into final pilot data format
pilot_data <- reference_data_processing(
  response_matrix = raw_data$response_matrix,
  read_umi_table = raw_data$read_umi_table,
  mapping_efficiency = raw_data$mapping_efficiency,
  TPM_thres = 0.1,
  h5_only = FALSE
)
}
\seealso{
\code{\link{obtain_expression_information}},
\code{\link{obtain_qc_read_umi_table}},
\code{\link{library_estimation}}
}
